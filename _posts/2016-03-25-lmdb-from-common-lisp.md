---
title: Using LMDB from Common Lisp
summary: Announcement for LMDB bindings, and a tutorial.
tags: [lisp, tutorial]
---

[LMDB][lmdb] is a fast key-value store. [This talk][talk] is useful for those
who want to learn more. The design of LMDB means many of the things that are
standard in other databases -- [write-ahead logs][wal], and all the filesystem
housekeeping necessary to implement concurrent transactions -- is unnecessasry
in LMDB.

The bindings are implemented as two separate libraries: [liblmdb][liblmdb], a
low-level, autogenerated [CFFI][cffi] binding; and [lmdb][cllmdb], the
high-level CLOS binding.

# Usage

Using LMDB requires some work. A simple query requires setting up (and tearing
down) a whole stack of objects, namely:

1. An _environment_, which is, essentially, a collection of databases. You
   create the environment object by passing a directory where LMDB will store
   its data.
2. A transaction within that environment. All queries have to take place inside
   a transaction.
3. A database access object, which is created from a transaction, after the
   transaction's been started. The database object keeps the name of the
   database we're accessing within the environment.

Or,

![LMDB lifecycle diagram]({{ site.post_images }}/lmdb/lifecycle.png)

When you have the database object, you can set, retrieve and delete key-value
pairs. For more complex operations, you have to use cursors, which add another
level of lifecycle management within databases.

# LMDB as a Service

As an example, I'll go through the implementation of a simple RESTful API for managing LMDB.

[lmdb]: http://symas.com/mdb/
[talk]: http://www.infoq.com/presentations/lmdb-lighting-memory-mapped-database
[wal]: https://en.wikipedia.org/wiki/Write-ahead_logging
[liblmdb]: https://github.com/antimer/liblmdb
[cffi]: https://common-lisp.net/project/cffi/
[cllmdb]: https://github.com/antimer/lmdb
