(ql:quickload (list :split-sequence :yason :local-time))

(defparameter +data+
  (list
   ;; January
   "5231   alexandria
    3821   cl-ppcre
    3799   trivial-features
    3664   babel
    3050   cffi
    2923   cl-fad
    2848   closer-mop
    2821   flexi-streams
    2770   slime
    2765   bordeaux-threads
    2632   iterate
    2631   trivial-gray-streams
    2629   trivial-garbage
    2276   split-sequence
    2221   named-readtables
    2172   chunga
    2147   anaphora
    2024   local-time
    1972   usocket
    1965   cl+ssl
    1931   md5
    1849   cl-base64
    1812   trivial-backtrace
    1573   metabang-bind
    1567   nibbles
    1531   ironclad
    1517   drakma
    1511   hunchentoot
    1429   puri
    1389   trivial-types
    1360   let-plus
    1282   cl-unicode
    1261   rfc2388
    1255   cl-syntax
    1245   chipz
    1235   cl-colors
    1184   cl-annot
    1171   cl-ansi-text
    1106   trivial-utf-8
    1074   optima
    1068   cl-interpol
    1057   cl-utilities
    1032   prove
     978   postmodern
     956   log4cl
     912   stefil
     897   cl-json
     871   quicklisp-slime-helper
     797   st-json
     787   parse-number
     753   cl-marshal
     692   fast-http
     674   http-body
     674   cl-sqlite
     668   cl-who
     656   osicat
     646   trivial-mimes
     610   circular-streams
     584   xsubseq
     576   quri
     571   trivial-arguments
     571   fiveam
     544   clack
     543   clx
     538   iolib
     536   salza2
     528   lparallel
     484   cl-dbi
     482   ieee-floats
     482   sxql
     464   parenscript
     454   closure-common
     448   symbol-munger
     447   asdf-system-connections
     437   fare-utils
     436   cl-opengl
     428   cxml
     409   cl-containers
     397   uuid
     395   metatilities-base
     391   static-vectors
     385   zpb-ttf
     373   yason
     369   html-template
     362   buildapp
     360   fare-quasiquote
     355   vecto
     351   ningle
     351   fast-io
     337   cl-yacc
     337   cl-async
     330   cl-vectors
     324   esrap
     319   command-line-arguments
     317   zpng
     313   do-urlencode
     310   myway
     309   map-set
     301   arnesi
     301   external-program"
   ;; February
   "4270   alexandria
    2825   trivial-features
    2753   cl-ppcre
    2740   babel
    2464   closer-mop
    2316   cl-fad
    2309   bordeaux-threads
    2211   cffi
    2126   iterate
    2103   trivial-garbage
    2063   slime
    2042   flexi-streams
    1944   trivial-gray-streams
    1867   split-sequence
    1771   anaphora
    1744   chunga
    1651   cl+ssl
    1646   usocket
    1601   local-time
    1558   cl-base64
    1441   metabang-bind
    1327   trivial-backtrace
    1304   named-readtables
    1292   drakma
    1277   nibbles
    1249   puri
    1234   ironclad
    1230   md5
    1206   optima
    1152   chipz
     988   trivial-types
     948   hunchentoot
     893   cl-utilities
     885   cl-unicode
     813   rfc2388
     784   let-plus
     777   quicklisp-slime-helper
     777   stefil
     753   cl-interpol
     745   trivial-utf-8
     729   cl-syntax
     724   cl-annot
     714   quri
     706   postmodern
     658   parse-number
     630   fiveam
     611   cl-colors
     591   salza2
     561   cl-json
     542   log4cl
     514   cl-ansi-text
     511   lparallel
     500   cl-who
     482   prove
     482   ieee-floats
     481   zpb-ttf
     473   zpng
     461   vecto
     453   cl-sqlite
     437   uuid
     433   cl-vectors
     425   cl-yacc
     423   st-json
     417   asdf-system-connections
     403   osicat
     394   parenscript
     385   metatilities-base
     383   cl-containers
     374   clx
     368   buildapp
     367   closure-common
     364   clack
     355   yason
     346   command-line-arguments
     345   fare-utils
     341   iolib
     335   cxml
     335   cl-marshal
     324   static-vectors
     312   fare-quasiquote
     309   xsubseq
     308   dynamic-classes
     304   py-configparser
     301   cl-markdown
     299   fast-http
     297   asdf-finalizers
     293   cl-log
     288   external-program
     286   trivial-indent
     286   cl-abnf
     282   garbage-pools
     279   plump
     279   cl-mssql
     274   contextl
     271   cl-opengl
     268   trivial-mimes
     264   html-template
     262   fast-io
     251   array-utils
     249   zs3"
   ;; March
   "5853   alexandria
    4149   cl-ppcre
    3465   closer-mop
    3382   trivial-features
    3296   babel
    3086   named-readtables
    2977   cffi
    2814   flexi-streams
    2795   bordeaux-threads
    2785   trivial-gray-streams
    2784   cl+ssl
    2722   cl-fad
    2641   trivial-garbage
    2315   nibbles
    2313   usocket
    2277   chunga
    2251   anaphora
    2235   cl-base64
    2218   optima
    2142   split-sequence
    1942   ironclad
    1839   puri
    1803   fiveam
    1768   iterate
    1753   drakma
    1729   chipz
    1641   cl-colors
    1629   trivial-backtrace
    1586   local-time
    1559   md5
    1493   slime
    1486   let-plus
    1401   fare-utils
    1392   fare-quasiquote
    1340   cl-ansi-text
    1190   prove
    1180   hunchentoot
    1098   cl-unicode
    1072   trivial-types
    1053   rfc2388
    1021   metabang-bind
    1010   cl-utilities
     986   cl-interpol
     961   cl-syntax
     950   trivial-utf-8
     889   introspect-environment
     846   quicklisp-slime-helper
     827   cl-annot
     802   parse-number
     757   st-json
     716   quri
     710   osicat
     709   postmodern
     686   cl-marshal
     658   trivial-mimes
     654   xsubseq
     651   lparallel
     648   plump
     645   jsown
     641   asdf-system-connections
     614   ieee-floats
     613   trivial-indent
     605   metatilities-base
     604   uuid
     603   array-utils
     601   cl-containers
     596   cl-json
     590   lquery
     584   fast-http
     572   cl-sqlite
     567   salza2
     556   clss
     538   clack
     500   static-vectors
     495   clx
     490   command-line-arguments
     464   cl-markdown
     463   py-configparser
     462   dynamic-classes
     455   circular-streams
     446   asdf-finalizers
     446   zpb-ttf
     446   cl-log
     445   fast-io
     443   cl-abnf
     442   garbage-pools
     440   buildapp
     435   cl-mssql
     425   cl-who
     399   zpng
     397   esrap
     395   http-body
     394   vecto
     391   cl-csv
     389   cl-vectors
     388   iolib
     358   closure-common
     353   lisp-namespace
     351   cl-opengl
     351   cl-dbi"
   ;; April
   "4230  alexandria
    3401  trivial-features
    3377  babel
    3366  cl-ppcre
    3102  cffi
    2717  bordeaux-threads
    2620  closer-mop
    2611  trivial-garbage
    2605  cl-fad
    2575  flexi-streams
    2574  trivial-gray-streams
    2471  cl+ssl
    2366  nibbles
    2245  usocket
    2228  cl-base64
    2210  split-sequence
    2191  chunga
    2087  slime
    2047  iterate
    2046  trivial-backtrace
    2042  drakma
    2002  anaphora
    1925  ironclad
    1691  puri
    1682  chipz
    1653  local-time
    1520  named-readtables
    1455  md5
    1399  hunchentoot
    1259  metabang-bind
    1152  cl-colors
    1124  let-plus
    1070  optima
    1051  cl-unicode
    1020  trivial-utf-8
     992  cl-syntax
     950  rfc2388
     946  cl-interpol
     943  trivial-types
     941  cl-annot
     934  cl-ansi-text
     846  postmodern
     839  prove
     803  parse-number
     799  asdf-system-connections
     791  uuid
     780  cl-utilities
     765  cl-containers
     765  metatilities-base
     760  quicklisp-slime-helper
     701  fast-io
     695  jsown
     672  ieee-floats
     671  lparallel
     664  static-vectors
     658  cl-json
     640  plump
     605  fiveam
     601  zpng
     594  lquery
     590  trivial-indent
     587  clss
     578  buildapp
     566  array-utils
     559  xsubseq
     557  cl-sqlite
     547  salza2
     546  quri
     542  command-line-arguments
     540  osicat
     521  garbage-pools
     520  fast-http
     515  cl-mssql
     509  cl-who
     508  cl-vectors
     506  clx
     505  iolib
     503  py-configparser
     499  dynamic-classes
     497  asdf-finalizers
     497  cl-log
     496  cl-marshal
     494  cl-markdown
     484  trivial-mimes
     483  cl-abnf
     477  clack
     465  fare-utils
     450  ningle
     418  zpb-ttf
     408  cl-dbi
     408  st-json
     404  http-body
     403  circular-streams
     398  closure-common
     392  fare-quasiquote
     380  cl-csv
     380  cxml
     377  parenscript
     373  myway
     352  map-set"
   ;; May
   "5093  alexandria
    3865  babel
    3442  cl-ppcre
    3296  trivial-features
    3109  cffi
    3023  usocket
    2979  cl+ssl
    2821  bordeaux-threads
    2723  flexi-streams
    2720  trivial-gray-streams
    2702  trivial-garbage
    2621  cl-fad
    2588  nibbles
    2442  chunga
    2390  closer-mop
    2380  chipz
    2326  cl-base64
    2266  drakma
    2247  split-sequence
    2160  ironclad
    2104  anaphora
    2100  puri
    1792  iterate
    1758  trivial-backtrace
    1658  slime
    1618  local-time
    1371  md5
    1268  named-readtables
    1152  metabang-bind
    1104  hunchentoot
    1071  let-plus
    1067  cl-unicode
    1009  cl-colors
     953  cl-interpol
     936  trivial-utf-8
     874  cl-ansi-text
     862  prove
     851  plump
     851  cl-utilities
     849  optima
     842  jsown
     825  uuid
     821  parse-number
     816  trivial-indent
     815  trivial-types
     806  array-utils
     804  lquery
     794  postmodern
     791  quicklisp-slime-helper
     787  rfc2388
     770  clss
     766  lparallel
     731  fiveam
     723  ieee-floats
     710  quri
     696  asdf-system-connections
     661  cl-annot
     642  metatilities-base
     641  cl-containers
     603  cl-sqlite
     573  cl-syntax
     571  command-line-arguments
     564  salza2
     538  py-configparser
     531  cl-json
     525  cl-abnf
     524  garbage-pools
     523  cl-log
     522  dynamic-classes
     521  cl-markdown
     517  cl-mssql
     516  buildapp
     507  cl-who
     500  static-vectors
     498  asdf-finalizers
     491  clack
     482  fast-io
     468  zpng
     466  cl-vectors
     452  fast-http
     449  proc-parse
     408  esrap
     400  osicat
     397  trivial-shell
     394  fare-utils
     389  zpb-ttf
     387  cl-csv
     385  clx
     371  vecto
     364  jonathan
     360  fare-quasiquote
     354  parenscript
     336  closure-common
     333  cl-coveralls
     327  xsubseq
     322  stefil
     319  ningle
     312  cxml
     309  cl-yacc
     292  lack"
   ;; June
   "8413  alexandria
    5803  babel
    5222  cffi
    5152  trivial-features
    4926  cl-ppcre
    4621  bordeaux-threads
    4308  trivial-gray-streams
    4208  closer-mop
    4112  usocket
    4068  flexi-streams
    3891  trivial-garbage
    3815  cl+ssl
    3727  cl-fad
    3597  split-sequence
    3591  anaphora
    3510  iterate
    3274  cl-base64
    3200  chunga
    3141  nibbles
    3136  chipz
    3083  puri
    2992  drakma
    2678  ironclad
    2521  named-readtables
    2407  local-time
    2391  let-plus
    2256  cl-colors
    2231  md5
    2152  slime
    2148  trivial-backtrace
    2089  cl-ansi-text
    1984  prove
    1769  metabang-bind
    1574  cl-unicode
    1512  optima
    1487  hunchentoot
    1455  cl-interpol
    1392  cl-utilities
    1328  rfc2388
    1301  cl-annot
    1215  quri
    1178  trivial-types
    1090  cl-syntax
    1080  fast-io
    1059  static-vectors
    1038  salza2
    1011  trivial-indent
    1000  cl-json
     966  plump
     943  parse-number
     941  ieee-floats
     933  trivial-utf-8
     918  array-utils
     841  fiveam
     802  postmodern
     778  proc-parse
     772  lparallel
     759  stefil
     751  quicklisp-slime-helper
     741  fast-http
     741  xsubseq
     740  clss
     734  lquery
     724  clack
     695  jsown
     693  lack
     677  cl-dbi
     676  jonathan
     669  closure-common
     666  osicat
     658  cl-html-parse
     658  cl-sqlite
     646  asdf-system-connections
     642  cxml
     634  uuid
     628  esrap
     625  yason
     619  symbol-munger
     611  fare-utils
     608  lisp-unit
     602  cl-who
     595  external-program
     585  cl-csv
     573  http-body
     572  metatilities-base
     569  cl-containers
     555  trivial-mimes
     545  fare-quasiquote
     538  hu.dwim.asdf
     524  cl-marshal
     520  log4cl
     511  zpng
     511  command-line-arguments
     490  cl-log
     478  html-template
     476  function-cache
     471  cl-yacc
     469  trivial-shell
     427  circular-streams
     422  cl-emb"
   ;; July
   "13137  alexandria
    8723  trivial-features
    8303  babel
    7185  cffi
    7095  bordeaux-threads
    6398  trivial-gray-streams
    6269  flexi-streams
    5246  trivial-garbage
    5126  usocket
    5072  closer-mop
    4989  cl-fad
    4772  cl-ppcre
    4725  split-sequence
    4659  anaphora
    4599  cl+ssl
    4317  cl-base64
    4159  chunga
    4097  puri
    4022  drakma
    3916  iterate
    3842  nibbles
    3773  chipz
    3256  named-readtables
    3183  ironclad
    2816  md5
    2816  local-time
    2783  let-plus
    2741  slime
    2702  uiop
    2595  trivial-backtrace
    2507  cl-colors
    2375  hunchentoot
    2313  cl-ansi-text
    2263  prove
    1924  cl-unicode
    1900  rfc2388
    1900  metabang-bind
    1863  trivial-types
    1860  cl-utilities
    1821  cl-annot
    1806  optima
    1777  fiveam
    1717  cl-interpol
    1700  cl-syntax
    1629  static-vectors
    1583  trivial-utf-8
    1580  quri
    1466  parse-number
    1450  fast-io
    1418  salza2
    1322  clack
    1313  quicklisp-slime-helper
    1296  cl-json
    1226  proc-parse
    1137  xsubseq
    1092  jonathan
    1068  fast-http
    1036  ieee-floats
    1025  osicat
    1019  closure-common
    1018  lack
     959  cxml
     957  asdf-system-connections
     937  zpb-ttf
     935  http-body
     914  uuid
     897  postmodern
     893  hu.dwim.asdf
     876  trivial-indent
     860  zpng
     835  plump
     833  cl-dbi
     827  esrap
     818  fare-utils
     813  jsown
     812  array-utils
     806  cl-who
     776  cl-yacc
     754  metatilities-base
     746  symbol-munger
     720  swap-bytes
     719  yason
     718  cl-containers
     711  trivial-mimes
     695  fare-quasiquote
     687  lisp-unit
     686  clss
     662  lquery
     648  cl-vectors
     636  iolib
     626  myway
     626  map-set
     625  parenscript
     608  lparallel
     607  arnesi
     605  log4cl
     592  hu.dwim.stefil
     588  cl-marshal
     585  vom
     578  external-program"))

(defun numerical-data ()
  (loop for monthly-data in +data+ collecting
    (reduce #'+
            (mapcar #'(lambda (line)
                        (parse-integer
                         (first
                          (remove ""
                                  (split-sequence:split-sequence #\Space line)
                                  :test #'string=))))
                    (split-sequence:split-sequence #\Newline monthly-data)))))

(let ((output (merge-pathnames #p"quicklisp-downloads.json"
                               (user-homedir-pathname)))
      (data (numerical-data)))
  (with-open-file (stream output
                          :direction :output
                          :if-exists :supersede
                          :if-does-not-exist :create)
    (yason:encode
     (loop for month from 1 to (length data)
           for monthly-downloads in data collecting
       (list (elt local-time:+month-names+ month)
             monthly-downloads))
     stream)))
